{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% set crumbs = [
{ label: "REST"|t, url: url('rest') },
{ label: "Requests"|t, url: url('rest/requests') },
] %}

{% set content %}

    <form method="post" accept-charset="UTF-8" data-saveshortcut>

        <input type="hidden" name="action" value="rest/saveRequest">
        <input type="hidden" name="redirect" value="rest/requests">

        {% if request.id %}
          <input type="hidden" name="requestId" value="{{ request.id }}">
        {% endif %}

        {{ forms.textField({
            label: 'Name'|t,
            name: 'name',
            id: 'name',
            required: true,
            first: true,
            value : request ? request.name : null,
            errors: request.getErrors('name')
        }) }}

        {{ forms.textField({
            label: 'Handle'|t,
            name: 'handle',
            id: 'handle',
            required: true,
            value : request ? request.handle : null,
            errors: request.getErrors('handle')
        }) }}


        {% set apiHandleOptions = [{label:"None", value:""}] %}
        {% for api in apis %}
            {% set apiHandleOptions = apiHandleOptions|merge([{ label: api.name|t, value: api.handle }]) %}
        {% endfor %}

        {{ forms.selectField({
            label: "API" | t,
            name: 'apiHandle',
            options: apiHandleOptions,
            value : request ? request.apiHandle : null
        }) }}

        {{ forms.textField({
            label: 'URL'|t,
            name: 'url',
            required: true,
            value : request ? request.url : null,
            errors: request.getErrors('url')
        }) }}

{#         {{ forms.textField({
            label: 'URI'|t,
            name: 'url',
            value : 'search',
        }) }}

        <p>
            <strong>Preview:</strong><br />
            <span class="light">https://www.googleapis.com/youtube/v3/</span>search
        </p>
 #}

{#
        {{ forms.textField({
            label: 'URL'|t,
            name: 'url',
            value : request ? request.url : null,
        }) }}
 #}
        {% set queryRows = [] %}
        {% for key, value in request.query %}
          {% set queryRows = queryRows|merge([{ key: key, value: value }]) %}
        {% endfor %}

        {{ forms.editableTableField({
          label: 'Query Parameters',
          id: 'query',
          rows: 4,
          textual: false,
          name: 'query',
          addRowLabel : 'Add parameter',
          cols : {
            'key' : {
                'heading' : 'Key',
                'type'   : 'singleline'
            },
            'value' : {
                'heading' : 'Value',
                'type'   : 'singleline'
            }
          },
          rows : queryRows
        }) }}


        {% set verbOptions = [
            { label: 'GET', value: 'get' },
            { label: 'POST', value: 'post' },
            { label: 'PUT', value: 'put' },
            { label: 'DELETE', value: 'delete' },
        ] %}

        {#

        {{ forms.selectField({
            label: "Verb" | t,
            name: 'verb',
            options: verbOptions,
            value: request ? request.verb : null,
        }) }}

        #}

        {% set responseFormatOptions = [
            { label: 'JSON', value: 'json' },
            { label: 'XML', value: 'xml' }
        ] %}
        {{ forms.selectField({
            label: "Response Format" | t,
            name: 'format',
            options: responseFormatOptions,
            value: request ? request.format : null,
        }) }}


        <div class="buttons">
            <input type="submit" class="btn submit" value="{{ 'Save'|t }}">
        </div>
    </form>

{% endset %}

{% if isNew %}
    {% set js %}
        new Craft.HandleGenerator('#name', '#handle');
    {% endset %}
    {% includeJs js %}
{% endif %}